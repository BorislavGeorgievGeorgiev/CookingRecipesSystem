using System.Text;

using AutoFixture;

using AutoMapper;

using CookingRecipesSystem.Application.Common.Interfaces;
using CookingRecipesSystem.Application.Common.Models;
using CookingRecipesSystem.Application.Ingredients.Commands.Create;
using CookingRecipesSystem.Domain.Entities;

using Microsoft.AspNetCore.Http;

using Moq;

using Shouldly;

namespace CookingRecipesSystem.Application.UnitTests.Ingredients.Commands.Create
{
	public class IngredientCreateCommandTests
	{
		private IFormFile GetPhotoFileMock()
		{
			string content = "0xFFD8FFE000104A46494600010101006000600000FFDB0084000503040404030504040405050506070C08070707070F0B0B090C110F1212110F111113161C1713141A1511111821181A1D1D1F1F1F13172224221E241C1E1F1E010505050706070E08080E1E1411141E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1EFFC00011080064006403012200021101031101FFC401A20000010501010101010100000000000000000102030405060708090A0B100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FA0100030101010101010101010000000000000102030405060708090A0B1100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00FA6A2B5006643B8FE94F99E38216918854452CC7D00AF9DBC1DF12BC47A4EA900BABB9B53D3E4F9658AE1F73A9EE558F4FE55EDFAC6AB6D7BE04BCD62C24F3A17B4774DBC9E9C83EE2B8F099AD0C5D394A9BD574EA76E3B27C460AA4635568F66B6380BA9AEBC53E296B8BCDDF62B75CDB447EEAE7BFFBD8EF5D8E9DA7C688A0607B57945878F34FD32F0ACDB9602373314C1538E95BEDF12B4F8AC3ED416E1A1FE13E5E377D33D6BF38A952AD69B9D6BB6DF5FEB63ECA585942118524AD65B7F5B9E9896E89805B1532A463A806BC3758F8B5AD4726DD3F49894640CDC484B7FDF23FC6B9FD4FE2478FE589E43A8416708C7FAAB70319EC33935AC631EB6FBCC56578A9F43E8ED9197CE47D2993C70B02063A57CB771E3CF1F47C45AE5E32B00C59D071FA0ABBA57C56F1C4385BB9AD6E81CE44916D3F9AD54A8A6AE9A2FF00B2F13167D0B716F0BC6CACAAC472452F84C4316B53C36729F25A1DF2478E376700FB1AF1897E24EAF3AC6B6F6D009255E42C841FC38E6BD67E0B8BF7D32EEFB52B6304933808A548F940F53C9EB5EAE4184A8F151A96F755F5F91E4E71FB9A0E127ABE877045452C31C830CA2AE108DDB1EF509DBBB01D58FA03CD7DE9F236339EC4EEF95B8F7149F626FEF0FF00BE6B47146053B0AE7C5D68D349318CBED651C923AD7B77C04D7A116BAC68D7ACBF618A2FB56E90F0A31871F4C60FE75E496B64915F15525C373CF6AE8F4C805B89ADFCC68D6FA0F25D978E0BAF5FAE31F8D7E5796E37D862D5482D93FCBFCCFD7B3DC2C2AE13D94FAB56FBC93C5377A2EB7E23177A0F86EDE2B489F86910EE94FF00788E8BED542F2C8DECE52EE66DAADBA2CAE1579EC07E55DF3E970ADADBA5AC404617923AE7DEA4B4D22DB601220C1193919EF5E26659C57AD5DBA9BFE07465D0C1E128AE48FF009FCCE7ADF4417045CC862D8A98964E064FF89AA1A86829723F7688B196C8C753FE35E8569A2A456CF0C581148C1C11ED9E9F9D5BB0D32C219F7CAAC84648206E278E98AE4C3CA552A24E56F36692CD634EEE3AF647965E7872FBEC0F1ED1728531180738F7FAD61DFF0085FEC76B1F9818CA01DC8473926BDEAF1AD6251125870EC48E300E71D7DC564EA9A2F972092E6351131E00E726BBEA395276A53E6B6E14337551AF690B5FF13C9FC39A059D9CE56EDA65122ABC0BFF002CF83CF07AF35EAFE0EF16CDA29167AA4A5F4FDD80EDCB403EBDD7F95575D26D750B79ECA684AA45FEAD97F8491CE2B3F5CD1D92C05AC60CB0B44626947DE538EB8AE9C0E6D88C2D455A2FD4E2CC70D86CC62E9C959FE5E8FF00431FE2578ABC41A88B8BAB19EE7ECEB2110C70C8515631FC471D4E39AF3AB2F10EAD0DD091666E06772484313EE735E876B6EC2D442C777963631F5C715E61AD40D0EB779E49CC0188551DCFA66BD1963EAD69C9CA4FB9960B034234F91416877BA37C5BF13DA58AC06ED5F693832812363EA466AEFF00C2E4F137FCFC5BFF00DF95FF000AF2E8E7902005E25C7182829DE7BFFCF587FEF81FE15AFF006862D68AA3FBD8E59260E4EEE92FB91D869F6A508DE18820F3DF35A579139D27509849E5BC76C228CF7DCF22918F7003568698D0C96D14513F9D295C657A66B3358695EE5E3457C00AACA075719C0FCABE77058A9D2AEE76E8D7DFA1EAE674562B9693D354FE4BFCCA1A67C49BED2E65B5D6AC99E303699ADC6ECE3B95EA3F0CD779A0F8C3C3F7F1036F7B1C9BC640270C3D883C8AF37D4741BA82486E2588CBE6B10513A20F73DEB72CB4A82DF4C0F0C114770411148CBB9B39E80F3FCEB5C652A156CE7A48E77848497EEB63D0EDF57B55E44E8B1FAFA558B6F16787E1BAD971A8C03B00E703F3AF3C365ACD9DAB4AEEC5645D8E481F2F1D715C95D69D0B349211233039380783EB5C987C2D1A6D6AD8FF00B29D54EEFEE3DEC78D3C397574A89AADA327B9E9F9D3B56BFD22FB128D4E39028F9516518CFD2BE7D9F4B25B6ED652DC820E08E3F5AAEF6922462259E48D94860DB8F3C74AF4250A5522D5F731592CA9C94A2DE87D1BA75CC0F0C65186CEEDEB5CEF8A7C496D6D0DD41A5A0B9BDDAC444390081D4FA0AF22B3BBD4E189608B51B8423A976214FB54B69AAEB5A4BBCD6F6F6726F5CC8113971CE49AA8D38BE58B7B194B2EAB4DCA5B9D51935087C2D1DC471892EA441E639E89BB966FD6B94BBB557D19D800D2AB82A73DC9FEB5A169E3B8628069DA8E98C91F9640915B2391DC628B692C6F2132C12C6C8BC9DAD903EA2A31119D36A56D0F472DB28384F495FEF3156C8B80CD2A239FBCAC47068FB07FD3CC5F98A965B489A57620312C4E48C669BF638BFB8953ED3CFF0003D6F626B68B24F15E0B5127CEBF367FC2BB8D13493316BCB840D2CC77371C74AC6BBB7D3F42B24BDBB68FCD62BE639390BC81F957A0DA44975A52C76F3F939518751923E94A30718B9DB567839863215AAAE4D97539AF14E92259A3413C31C2909F9371DCCDF41590B6B34691F92405DBCE3A035DBFFC225632DD19A5BAB995A4C13B9BB8AD5B3F08E968E647591F230416E0D7155C357AB2D17E238E6F430F4D46EDDBC8E160BC5974D6B59990B31192DC8001ED8EFC5678B48259CAB6D7193F7862BD657C31A5A5A35BA5AA142383FC43F1AAB65E1286D4831BC6E48C3F9B1060467B67A1AD565F5A525CCFA18C33DC3C549C6EAE798C9E1D92E1CBDAC47712305CE3FEF9A866F074A01FB4040D819E771F71C702BDC66D36C1ACD2DD2CBF7B8019C90362F19C7D6B03C6BA469F069C2F2D326459C200B9390467AF1CE3DABD196513A746552334ECBBDBF42287124EACD53B5AEFD4F1FD434748C6F810AED1B473FD2B2AEAC1E2DB2CD1B671B4B139CE6BD4E4F0CEA13B7DA5E2CEE4F9433807DBA0F4C53EDBC13197335FDC1949E88A3017FC6BCC8D3AEA564AE8F6166F8651F7DFDC7907F625ECF196B48496009080649FFF005D41E194FB2EB0B65756E144EC464A639FA8F7AF7A5D2ADED942410845E8485EBF8D67DE68D64F23486CA1DE0E73B4673EB9AEEA73A905667054C7D0AEDFBB63CFEEA2944B86863380003E58E4545E5BFF00CF04FF00BF62BAEBCB1266E14631E950FD85BFBA3F2A874A8C9DF51C31D5A115156D0F16D461D5EF34E6B1B99E4B989BAA48D815D7FC3BF1B5E787DA1D27C4408B71F2C375BB72A8EC1B1D3EB5DC6A5F0F354D3955EEA10E84851242A6405BD38158ABA1DAC1036E489831C132446B6AF8BAB47F775E9B5F87DC74FB1C06263CD4649F9A3D5F4ABDB6BD852586549118641539CD6CDA939209256BE7EB65D4B46BC2DE1FB89ECC91916ECBBA063FEE9E47E18AE9342F8AF796C3C8D7B41BA5EDE7D97EF549F753861FAD4D29C6A3BC1FE87898DC971105CD1575E47B5850707914E0C1707DEBCAA2F8DBE09DC229AFEEEDE5FEE4B65286FF00D069CFF1C7E1F46E125D6A6527B9B3940FFD06BBBD8D67B459F3F3C2D487C48F43D79C7D9D76BB21DDD454F651C4D6B18540C319E79AF2FBCF8C9F0E2E7CB32F89E18A3CF4686407FF0041AD7B2F8B9F0EE555483C5DA58C0C01249B3F9E2B9E9E0F17F589CE706A364B51371F66A317A9DE4888460AF1F5AA72A9CED5000FE75CCC9F12FC15B770F14690C3FD9BA4FF001A8A5F897E0C280A6BD60E4F40B283FCAB4952ABFCA694A9547B2B9D0BC79625BEEAF3F5ACE9CA9C92319AE7AF3E22E82613F679DE7CF4D9131CFD0E315CD6A3E35BDBB93C9B3B4306FE04931E17F015CB51F2FC4CF670B80C44F5516743A96B1A5D8DD186EAF2DE27C6E0AEE01C555FF849342FFA08D9FF00DFC15C55F786B4BBBB96B9BF45BDB8939799F92DFE03DAA1FF008447C3FF00F40F87FEF9AE75986196967F77FC13D0FECDACFA9F43C7E23B26951618EDED59092DBE438623A72A796ACED575BD32EAC24B69B4F58660BB84D0608C91C120FE1F99A8E6D2A168F10C61589C926B3AE74C9A394ABA6E427820702BA3199F6630838D48277F2BAFCBF147CFE1F0D84E6E68B7A79FF5F899B06890EA109DAE236394258F0C5B91F4E3FA5666A1E127B089C79509DA799339AEC34CD3A132F9B239431F4507AD49751DC67111FDC8E49661CD79F2952AB463270E59793DFD51EAC331AD4EA72C67A7F5D4F1DBDB1D396E588B21E6A1C86279045684DA1E9B7B031B8B2B73BD323746315D86B761A5CF3B3F9004AC7924F534ED3EC44D6FB3C82888368E2B4A178BF76573D7AB8EA75692938FDE79427C16D1F54D0B57D6DF5516715AB36EB758B710700A85E7B938158BE1CF83DA45B58896FE16B89C9DCD9E807A0AF62D5A17B245B546FF0047B9993CD4CF5D84B0FD6AC428A2410701594B7E15EDE3738AB52853A506D34B57DDDEDF91E0E1B2FA74B1152B6E9BBA5D95B5FC6E798E91E19D234BBE62347B3620613280E3DFEB5D1DDC36F30105AD95B46A063708C0C9F4A6789ADA45D54F952E2307A0E73EC4D36D226F2C4DFBB2C8DF75FBD7CD54AF526FDF95CFAF8D1A5CB1AB14AE598B49D46EE3F2E2B4CB904A0CF0DB7A81F4A9DFC09E29FB325C9D2D92DD882C038CB124E300751EF576DF565B731430EF640448EE015646C7233DF9C7E55BABE32BB7B37B4B6925850ED0467A2F031C74E95EA61A196460FDB4DDFCADFD7E279D5F1798C1AF6318DBCEFF00E671573A46B96D2981EC1936640DC3EF0CF51ED517F67EB3FF003E95D2EA1AE6A57771E6497664206D0597B673E9EF55FF00B4EFFF00E7B8FF00BE7FFAD5C339E0549F2CA56F45FE674C3138A715CD18DFE67BBFF61E9C47CB1BA7FBB21ACBD634C86D537452CDC7386607FA56A7F61E9C47CB1BA7FBB21ACBD634C86D537452CDC7386607FA57EAD8DC373527FB98BF9FFF006A7E3742ADA6BDF6BE5FF04A368B19881F2A3C8EF8A2F6DE17898B46A703345A2C66207CA8F23BE28BDB785E262D1A9C0CD7C462A95A2D7225FD7A1EED297BC9DD99567676ED995A30CC0F19ED52DC0033850315159D9DBB66568C3303C67B54B7000CE140C579B87872C17BA97F5E87A72779EF70D1348B1D4AD6FDEEE2DE42ED5FF67BE47BD71E618E6430CABB954F1EB5D8689A458EA56B7EF7716F2176AFFB3DF23DEB8F30C73218655DCAA78F5AF6736A56C0D07C896FAF7F5D3E6565952F8AACB9DF4D3B7A6A624B6F1B1959B7120E7AD598EC6D5187EEC36E209CD5696DE3632B36E241CF5AB31D8DAA30FDD86DC4139AF85B7BC7D6CA7EEFC4CADE546B7270A07CD8CD4F628A5DA2C615BAE3AD41E546B7270A07CD8CD4F628A5DA2C615BAE3AD7337AEE39BF7773ACB3D36CE284010839E496E6A6FB0DA7FCF04FCAA1B3D36CE284010839E496E6A6FB0DA7FCF04FCABE8614FDD5EE2FEBE47CCCEA5E4FDF7FD7CCFFD9";
			byte[] bytes = Encoding.Unicode.GetBytes(content);

			var file = new FormFile(
					baseStream: new MemoryStream(bytes),
					baseStreamOffset: 0,
					length: bytes.Length,
					name: "Data",
					fileName: "dummy.jpeg"
			)
			{
				Headers = new HeaderDictionary(),
				ContentType = "image/jpeg"
			};

			return file;
		}

		[Fact]
		public async Task Handle_Should_Persist_Ingredient()
		{
			//Arrange
			const string IngredientName = "TestIngredient";
			const string IngredientDescription = "TestIngredient Description.";

			Fixture fixture = new Fixture();
			var photoResponseModel = fixture.Create<PhotoResponseModel>();
			var photoFile = fixture.Create<Photo>();
			var ingredient = fixture.Create<Ingredient>();

			string content = "0xFFD8FFE000104A46494600010101006000600000FFDB0084000503040404030504040405050506070C08070707070F0B0B090C110F1212110F111113161C1713141A1511111821181A1D1D1F1F1F13172224221E241C1E1F1E010505050706070E08080E1E1411141E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1E1EFFC00011080064006403012200021101031101FFC401A20000010501010101010100000000000000000102030405060708090A0B100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FA0100030101010101010101010000000000000102030405060708090A0B1100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00FA6A2B5006643B8FE94F99E38216918854452CC7D00AF9DBC1DF12BC47A4EA900BABB9B53D3E4F9658AE1F73A9EE558F4FE55EDFAC6AB6D7BE04BCD62C24F3A17B4774DBC9E9C83EE2B8F099AD0C5D394A9BD574EA76E3B27C460AA4635568F66B6380BA9AEBC53E296B8BCDDF62B75CDB447EEAE7BFFBD8EF5D8E9DA7C688A0607B57945878F34FD32F0ACDB9602373314C1538E95BEDF12B4F8AC3ED416E1A1FE13E5E377D33D6BF38A952AD69B9D6BB6DF5FEB63ECA585942118524AD65B7F5B9E9896E89805B1532A463A806BC3758F8B5AD4726DD3F49894640CDC484B7FDF23FC6B9FD4FE2478FE589E43A8416708C7FAAB70319EC33935AC631EB6FBCC56578A9F43E8ED9197CE47D2993C70B02063A57CB771E3CF1F47C45AE5E32B00C59D071FA0ABBA57C56F1C4385BB9AD6E81CE44916D3F9AD54A8A6AE9A2FF00B2F13167D0B716F0BC6CACAAC472452F84C4316B53C36729F25A1DF2478E376700FB1AF1897E24EAF3AC6B6F6D009255E42C841FC38E6BD67E0B8BF7D32EEFB52B6304933808A548F940F53C9EB5EAE4184A8F151A96F755F5F91E4E71FB9A0E127ABE877045452C31C830CA2AE108DDB1EF509DBBB01D58FA03CD7DE9F236339EC4EEF95B8F7149F626FEF0FF00BE6B47146053B0AE7C5D68D349318CBED651C923AD7B77C04D7A116BAC68D7ACBF618A2FB56E90F0A31871F4C60FE75E496B64915F15525C373CF6AE8F4C805B89ADFCC68D6FA0F25D978E0BAF5FAE31F8D7E5796E37D862D5482D93FCBFCCFD7B3DC2C2AE13D94FAB56FBC93C5377A2EB7E23177A0F86EDE2B489F86910EE94FF00788E8BED542F2C8DECE52EE66DAADBA2CAE1579EC07E55DF3E970ADADBA5AC404617923AE7DEA4B4D22DB601220C1193919EF5E26659C57AD5DBA9BFE07465D0C1E128AE48FF009FCCE7ADF4417045CC862D8A98964E064FF89AA1A86829723F7688B196C8C753FE35E8569A2A456CF0C581148C1C11ED9E9F9D5BB0D32C219F7CAAC84648206E278E98AE4C3CA552A24E56F36692CD634EEE3AF647965E7872FBEC0F1ED1728531180738F7FAD61DFF0085FEC76B1F9818CA01DC8473926BDEAF1AD6251125870EC48E300E71D7DC564EA9A2F972092E6351131E00E726BBEA395276A53E6B6E14337551AF690B5FF13C9FC39A059D9CE56EDA65122ABC0BFF002CF83CF07AF35EAFE0EF16CDA29167AA4A5F4FDD80EDCB403EBDD7F95575D26D750B79ECA684AA45FEAD97F8491CE2B3F5CD1D92C05AC60CB0B44626947DE538EB8AE9C0E6D88C2D455A2FD4E2CC70D86CC62E9C959FE5E8FF00431FE2578ABC41A88B8BAB19EE7ECEB2110C70C8515631FC471D4E39AF3AB2F10EAD0DD091666E06772484313EE735E876B6EC2D442C777963631F5C715E61AD40D0EB779E49CC0188551DCFA66BD1963EAD69C9CA4FB9960B034234F91416877BA37C5BF13DA58AC06ED5F693832812363EA466AEFF00C2E4F137FCFC5BFF00DF95FF000AF2E8E7902005E25C7182829DE7BFFCF587FEF81FE15AFF006862D68AA3FBD8E59260E4EEE92FB91D869F6A508DE18820F3DF35A579139D27509849E5BC76C228CF7DCF22918F7003568698D0C96D14513F9D295C657A66B3358695EE5E3457C00AACA075719C0FCABE77058A9D2AEE76E8D7DFA1EAE674562B9693D354FE4BFCCA1A67C49BED2E65B5D6AC99E303699ADC6ECE3B95EA3F0CD779A0F8C3C3F7F1036F7B1C9BC640270C3D883C8AF37D4741BA82486E2588CBE6B10513A20F73DEB72CB4A82DF4C0F0C114770411148CBB9B39E80F3FCEB5C652A156CE7A48E77848497EEB63D0EDF57B55E44E8B1FAFA558B6F16787E1BAD971A8C03B00E703F3AF3C365ACD9DAB4AEEC5645D8E481F2F1D715C95D69D0B349211233039380783EB5C987C2D1A6D6AD8FF00B29D54EEFEE3DEC78D3C397574A89AADA327B9E9F9D3B56BFD22FB128D4E39028F9516518CFD2BE7D9F4B25B6ED652DC820E08E3F5AAEF6922462259E48D94860DB8F3C74AF4250A5522D5F731592CA9C94A2DE87D1BA75CC0F0C65186CEEDEB5CEF8A7C496D6D0DD41A5A0B9BDDAC444390081D4FA0AF22B3BBD4E189608B51B8423A976214FB54B69AAEB5A4BBCD6F6F6726F5CC8113971CE49AA8D38BE58B7B194B2EAB4DCA5B9D51935087C2D1DC471892EA441E639E89BB966FD6B94BBB557D19D800D2AB82A73DC9FEB5A169E3B8628069DA8E98C91F9640915B2391DC628B692C6F2132C12C6C8BC9DAD903EA2A31119D36A56D0F472DB28384F495FEF3156C8B80CD2A239FBCAC47068FB07FD3CC5F98A965B489A57620312C4E48C669BF638BFB8953ED3CFF0003D6F626B68B24F15E0B5127CEBF367FC2BB8D13493316BCB840D2CC77371C74AC6BBB7D3F42B24BDBB68FCD62BE639390BC81F957A0DA44975A52C76F3F939518751923E94A30718B9DB567839863215AAAE4D97539AF14E92259A3413C31C2909F9371DCCDF41590B6B34691F92405DBCE3A035DBFFC225632DD19A5BAB995A4C13B9BB8AD5B3F08E968E647591F230416E0D7155C357AB2D17E238E6F430F4D46EDDBC8E160BC5974D6B59990B31192DC8001ED8EFC5678B48259CAB6D7193F7862BD657C31A5A5A35BA5AA142383FC43F1AAB65E1286D4831BC6E48C3F9B1060467B67A1AD565F5A525CCFA18C33DC3C549C6EAE798C9E1D92E1CBDAC47712305CE3FEF9A866F074A01FB4040D819E771F71C702BDC66D36C1ACD2DD2CBF7B8019C90362F19C7D6B03C6BA469F069C2F2D326459C200B9390467AF1CE3DABD196513A746552334ECBBDBF42287124EACD53B5AEFD4F1FD434748C6F810AED1B473FD2B2AEAC1E2DB2CD1B671B4B139CE6BD4E4F0CEA13B7DA5E2CEE4F9433807DBA0F4C53EDBC13197335FDC1949E88A3017FC6BCC8D3AEA564AE8F6166F8651F7DFDC7907F625ECF196B48496009080649FFF005D41E194FB2EB0B65756E144EC464A639FA8F7AF7A5D2ADED942410845E8485EBF8D67DE68D64F23486CA1DE0E73B4673EB9AEEA73A905667054C7D0AEDFBB63CFEEA2944B86863380003E58E4545E5BFF00CF04FF00BF62BAEBCB1266E14631E950FD85BFBA3F2A874A8C9DF51C31D5A115156D0F16D461D5EF34E6B1B99E4B989BAA48D815D7FC3BF1B5E787DA1D27C4408B71F2C375BB72A8EC1B1D3EB5DC6A5F0F354D3955EEA10E84851242A6405BD38158ABA1DAC1036E489831C132446B6AF8BAB47F775E9B5F87DC74FB1C06263CD4649F9A3D5F4ABDB6BD852586549118641539CD6CDA939209256BE7EB65D4B46BC2DE1FB89ECC91916ECBBA063FEE9E47E18AE9342F8AF796C3C8D7B41BA5EDE7D97EF549F753861FAD4D29C6A3BC1FE87898DC971105CD1575E47B5850707914E0C1707DEBCAA2F8DBE09DC229AFEEEDE5FEE4B65286FF00D069CFF1C7E1F46E125D6A6527B9B3940FFD06BBBD8D67B459F3F3C2D487C48F43D79C7D9D76BB21DDD454F651C4D6B18540C319E79AF2FBCF8C9F0E2E7CB32F89E18A3CF4686407FF0041AD7B2F8B9F0EE555483C5DA58C0C01249B3F9E2B9E9E0F17F589CE706A364B51371F66A317A9DE4888460AF1F5AA72A9CED5000FE75CCC9F12FC15B770F14690C3FD9BA4FF001A8A5F897E0C280A6BD60E4F40B283FCAB4952ABFCA694A9547B2B9D0BC79625BEEAF3F5ACE9CA9C92319AE7AF3E22E82613F679DE7CF4D9131CFD0E315CD6A3E35BDBB93C9B3B4306FE04931E17F015CB51F2FC4CF670B80C44F5516743A96B1A5D8DD186EAF2DE27C6E0AEE01C555FF849342FFA08D9FF00DFC15C55F786B4BBBB96B9BF45BDB8939799F92DFE03DAA1FF008447C3FF00F40F87FEF9AE75986196967F77FC13D0FECDACFA9F43C7E23B26951618EDED59092DBE438623A72A796ACED575BD32EAC24B69B4F58660BB84D0608C91C120FE1F99A8E6D2A168F10C61589C926B3AE74C9A394ABA6E427820702BA3199F6630838D48277F2BAFCBF147CFE1F0D84E6E68B7A79FF5F899B06890EA109DAE236394258F0C5B91F4E3FA5666A1E127B089C79509DA799339AEC34CD3A132F9B239431F4507AD49751DC67111FDC8E49661CD79F2952AB463270E59793DFD51EAC331AD4EA72C67A7F5D4F1DBDB1D396E588B21E6A1C86279045684DA1E9B7B031B8B2B73BD323746315D86B761A5CF3B3F9004AC7924F534ED3EC44D6FB3C82888368E2B4A178BF76573D7AB8EA75692938FDE79427C16D1F54D0B57D6DF5516715AB36EB758B710700A85E7B938158BE1CF83DA45B58896FE16B89C9DCD9E807A0AF62D5A17B245B546FF0047B9993CD4CF5D84B0FD6AC428A2410701594B7E15EDE3738AB52853A506D34B57DDDEDF91E0E1B2FA74B1152B6E9BBA5D95B5FC6E798E91E19D234BBE62347B3620613280E3DFEB5D1DDC36F30105AD95B46A063708C0C9F4A6789ADA45D54F952E2307A0E73EC4D36D226F2C4DFBB2C8DF75FBD7CD54AF526FDF95CFAF8D1A5CB1AB14AE598B49D46EE3F2E2B4CB904A0CF0DB7A81F4A9DFC09E29FB325C9D2D92DD882C038CB124E300751EF576DF565B731430EF640448EE015646C7233DF9C7E55BABE32BB7B37B4B6925850ED0467A2F031C74E95EA61A196460FDB4DDFCADFD7E279D5F1798C1AF6318DBCEFF00E671573A46B96D2981EC1936640DC3EF0CF51ED517F67EB3FF003E95D2EA1AE6A57771E6497664206D0597B673E9EF55FF00B4EFFF00E7B8FF00BE7FFAD5C339E0549F2CA56F45FE674C3138A715CD18DFE67BBFF61E9C47CB1BA7FBB21ACBD634C86D537452CDC7386607FA56A7F61E9C47CB1BA7FBB21ACBD634C86D537452CDC7386607FA57EAD8DC373527FB98BF9FFF006A7E3742ADA6BDF6BE5FF04A368B19881F2A3C8EF8A2F6DE17898B46A703345A2C66207CA8F23BE28BDB785E262D1A9C0CD7C462A95A2D7225FD7A1EED297BC9DD99567676ED995A30CC0F19ED52DC0033850315159D9DBB66568C3303C67B54B7000CE140C579B87872C17BA97F5E87A72779EF70D1348B1D4AD6FDEEE2DE42ED5FF67BE47BD71E618E6430CABB954F1EB5D8689A458EA56B7EF7716F2176AFFB3DF23DEB8F30C73218655DCAA78F5AF6736A56C0D07C896FAF7F5D3E6565952F8AACB9DF4D3B7A6A624B6F1B1959B7120E7AD598EC6D5187EEC36E209CD5696DE3632B36E241CF5AB31D8DAA30FDD86DC4139AF85B7BC7D6CA7EEFC4CADE546B7270A07CD8CD4F628A5DA2C615BAE3AD41E546B7270A07CD8CD4F628A5DA2C615BAE3AD7337AEE39BF7773ACB3D36CE284010839E496E6A6FB0DA7FCF04FCAA1B3D36CE284010839E496E6A6FB0DA7FCF04FCABE8614FDD5EE2FEBE47CCCEA5E4FDF7FD7CCFFD9";
			byte[] bytes = Encoding.Unicode.GetBytes(content);
			IFormFile iFormFileFile = new FormFile(new MemoryStream(bytes), 0, bytes.Length, "Data", "dummy.jpeg");

			var command = new IngredientCreateCommand
			{
				Name = IngredientName,
				Description = IngredientDescription,
				PhotoFile = iFormFileFile,
			};

			var mockedMapper = new Mock<IMapper>();
			mockedMapper
				.Setup(x => x.Map<Photo>(It.IsAny<PhotoResponseModel>()))
				.Returns(photoFile);
			mockedMapper
				.Setup(x => x.Map<Ingredient>(It.IsAny<IngredientRequestModel>()))
				.Returns(ingredient);

			var mockedPhotoService = new Mock<IPhotoService>();
			mockedPhotoService
				.Setup(x => x.Process(It.IsAny<IFormFile>(), CancellationToken.None))
				.Returns(Task.FromResult(photoResponseModel));

			var mockedPhotoRepository = new Mock<IAppRepository<Photo>>();
			mockedPhotoRepository
				.Setup(x => x.Create(It.IsAny<Photo>(), CancellationToken.None))
				.Returns(Task.FromResult(photoFile));

			var mockedIngredientRepository = new Mock<IAppRepository<Ingredient>>();
			mockedIngredientRepository
				.Setup(x => x.Create(ingredient, CancellationToken.None))
				.Returns(Task.FromResult(ingredient));
			mockedIngredientRepository
				.Setup(x => x.SaveAsync(CancellationToken.None))
				.Returns(Task.FromResult(1));

			var handler = new IngredientCreateCommand
				.IngredientCreateCommandHandler(
				mockedPhotoService.Object,
				mockedIngredientRepository.Object,
				mockedPhotoRepository.Object,
				mockedMapper.Object);

			//Act
			var result = await handler.Handle(command, CancellationToken.None);

			//Assert
			result.Succeeded.ShouldBe(true);
		}
	}
}
